@model IEnumerable<WebMobileStore.Models.Entity.Orders>
@using WebMobileStore.Models.Entity.Enums

@{
    ViewBag.Title = "Quản lý đơn hàng";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
@section Styles {
    <link rel="stylesheet" href="~/css/order.css" />
}
<div class="page-content">
    <h2 class="page-title">Quản lý đơn hàng</h2>

    <div class="table-card">
        @if (Model != null && Model.Any())
        {
            <table class="order-table">
                <thead>
                    <tr>
                        <th>Mã đơn</th>
                        <th>Khách hàng</th>
                        <th>Tổng tiền</th>
                        <th>Thanh toán</th>
                        <th>Trạng thái</th>
                        <th>Ngày đặt</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var order in Model)
                    {
                        <tr>
                            <td>#ORD-@order.OrdersId</td>
                            <td>@(order.User?.FullName ?? "N/A")</td>
                            <td>@order.TotalAmount.ToString("N0")₫</td>
                            <td>
                                <span class="badge @(order.PaymentStatus == PaymentStatus.Paid ? "badge-success" : "badge-warning")">
                                    @(order.PaymentStatus == PaymentStatus.Paid ? "Đã thanh toán" : "Chưa thanh toán")
                                </span>
                            </td>
                            <td>
                                <span class="badge badge-@order.OrderStatus.ToString().ToLower()">
                                    @switch (order.OrderStatus)
                                    {
                                        case OrderStatus.Pending:
                                            @:Chờ xử lý
                                            break;
                                        case OrderStatus.Confirmed:
                                            @:Đã xác nhận
                                            break;
                                        case OrderStatus.Shipped:
                                            @:Đang giao hàng
                                            break;
                                        case OrderStatus.Delivered:
                                            @:Đã giao hàng
                                            break;
                                        case OrderStatus.Cancelled:
                                            @:Đã hủy
                                            break;
                                        default:
                                            @order.OrderStatus.ToString()
                                            break;
                                    }
                                </span>
                            </td>
                            <td>@order.OrderdAt.ToString("dd/MM/yyyy HH:mm")</td>
                            <td>
                                <div class="action-group">
                                    <a asp-action="OrderDetail" asp-route-id="@order.OrdersId" class="btn btn-info btn-sm">Chi tiết</a>

                                    @if (order.OrderStatus == OrderStatus.Pending)
                                    {
                                        <form asp-action="UpdateOrderStatus" method="post" style="display:inline;">
                                            <input type="hidden" name="orderId" value="@order.OrdersId" />
                                            <input type="hidden" name="status" value="@OrderStatus.Confirmed" />
                                            <button type="submit" class="btn btn-primary btn-sm">Xác nhận</button>
                                        </form>
                                    }
                                    else if (order.OrderStatus == OrderStatus.Confirmed)
                                    {
                                        <form asp-action="UpdateOrderStatus" method="post" style="display:inline;">
                                            <input type="hidden" name="orderId" value="@order.OrdersId" />
                                            <input type="hidden" name="status" value="@OrderStatus.Shipped" />
                                            <button type="submit" class="btn btn-warning btn-sm">Giao hàng</button>
                                        </form>
                                    }
                                    else if (order.OrderStatus == OrderStatus.Shipped)
                                    {
                                        <form asp-action="UpdateOrderStatus" method="post" style="display:inline;">
                                            <input type="hidden" name="orderId" value="@order.OrdersId" />
                                            <input type="hidden" name="status" value="@OrderStatus.Delivered" />
                                            <button type="submit" class="btn btn-success btn-sm">Hoàn tất</button>
                                        </form>
                                    }

                                    @if (order.OrderStatus != OrderStatus.Cancelled && order.OrderStatus != OrderStatus.Delivered)
                                    {
                                        <form asp-action="UpdateOrderStatus" method="post" style="display:inline;">
                                            <input type="hidden" name="orderId" value="@order.OrdersId" />
                                            <input type="hidden" name="status" value="@OrderStatus.Cancelled" />
                                            <button type="submit" class="btn btn-danger btn-sm">Hủy</button>
                                        </form>
                                    }
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div class="empty-state">
                <p>🛒 Chưa có đơn hàng nào</p>
            </div>
        }
    </div>
</div>

@if (ViewBag.TotalPages > 1)
{
    <div class="pagination">
        @for (int i = 1; i <= ViewBag.TotalPages; i++)
        {
            <a class="page-link @(i == ViewBag.Page ? "active" : "")"
               href="@Url.Action("Orders", new { page = i })">@i</a>
        }
    </div>
}